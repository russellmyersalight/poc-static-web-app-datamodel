<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test D3 Data Model Graph</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="./css/datamodelstyles.css">
</head>
<body>

<div class="container-fluid">
    <div class ="row">
        <div class = "col-8">
            <h1 class="h1 text-center">hrX Data Model</h1>
        </div>
    </div>
    <div class="row vh-600">
        <div class = "col-8">

            <!--svg id="network" width="1200", height="600" style="border: 2px solid black"></svg-->
            <svg id="network" class="h-100 w-100"  style="border: 2px solid black; min-height:900px">

            </svg>

        </div>
        <div class = "col-4">
            <div class = "row">
                <form>
                  <div class="mb-3">
                     <label for="chargeStrength" class="form-label" id="charge-strength-label">Charge strength</label>
                     <input type="range" class="form-range" min=-1000 max=200 id="chargeStrength" value=-208 onchange = "chargeStrengthSliderChanged(this.value)">
                  </div>
                  <div class="mb-3">
                     <label for="linkStrength" class="form-label" id="link-strength-label">Link strength</label>
                     <input type="range" class="form-range" min=0 max=2 step="0.1" id="linkStrength" value=0.2 onchange = "linkStrengthSliderChanged(this.value)">
                  </div>
                  <div class="mb-3">
                      <input type="radio" class="btn-check" name="options" id="option1" autocomplete="off"  value="All" onclick="radioButtonClicked(this.value)">
                        <label class="btn" for="option1">All</label>

                        <input type="radio" class="btn-check" name="options" id="option2" autocomplete="off"  checked value="Modules" onclick="radioButtonClicked(this.value)">
                        <label class="btn" for="option2">Modules</label>


                        <input type="radio" class="btn-check" name="options" id="option4" autocomplete="off" value="Pay/Calc" onclick="radioButtonClicked(this.value)">
                        <label class="btn" for="option4">Pay/Calc</label>
                  </div>
                  <div class="mb-3">
                      <div class="form-check">
                          <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" onclick="piiCheckboxClicked(this)">
                          <label class="form-check-label" for="flexCheckDefault">
                            Show PII
                          </label>

                      </div>
                  </div>

                </form>
            </div>
            <div class = "row">

                 <div class="card" id="node-card" style="width: 30rem; visibility: hidden" >
                      <div class="card-body">
                            <h5 class="card-title" id="node-card-title">Card title</h5>
                            <p class="card-text">Description of the node here..</p>
                      </div>

                      <ul id="node-card-list-group" class="list-group list-group-flush">
                      </ul>

                 </div>
            </div>

            </div>
        </div>
    </div>


</div>

<script src=https://d3js.org/d3.v4.min.js></script>
<script src="./js/utils.js"></script>
<script src="./js/view.js"></script>
<script src="./js/eventlisteners.js"></script>
<script src="./js/model.js"></script>
<script>

    useMyers = false;

    zoom = d3.zoom()
        .scaleExtent([0.1, 4])
        .on("zoom", zoomed);


    linkStrengthVal = 0.3;
    chargeStrengthVal  = -344; //-344;

    chargeStrengthUpdated();
    linkStrengthUpdated();

    levelUse =  'Modules';
    levelUseChanged();


    useMyers = false;

    //qq = rectX + (parseInt(svg.style("width")) / 2);

    svg.style("min-height", window.innerHeight - 100);
    rect = document.getElementById("network").getBoundingClientRect();
    width =  rect.width;
    height = rect.height;


    svg.append("text") //.attr(x<text x="400" y="100" className="lead">Loading graph...</text>
       .attr("x", rect.x + (parseInt(svg.style("width")) / 2))
       .attr("y",rect.y + (parseInt(svg.style("height")) / 2) - 100)
       .style("text-anchor", "middle")
       .style("font-size", "34px")
       .text("Loading graph...");

    queriesReturned = [false, false, false, false];

    url = 'https://func-alg-t-weu-gremlin-api.azurewebsites.net/api/gremlinquery';

    params = "query=g.V()";
    callback = ajaxVerticesReturned;
    sendAjax(url=url, params=params, callback=callback, method='GET', payload=null);

    params = "query=g.E()";
    callback = ajaxEdgesReturned;
    sendAjax(url=url, params=params, callback=callback, method='GET', payload=null);


    function assembleLinkedNodeParam(module, depth=5) {
        return "query=g.V().has('name', '" + module + "').emit().repeat(out()).times(" + depth + ")";
    }

    var modules = ['Pay/Calc', 'Payroll Verification', 'Core'];

    params = assembleLinkedNodeParam("Pay/Calc");  //"query=g.V().has('name', 'Pay/Calc').emit().repeat(out()).times(5)";
    callback = ajaxModuleLinksReturned; //ajaxPayCalcLinksReturned;
    sendAjax(url=url, params=params, callback=callback, method='GET', payload=null);


    params =  assembleLinkedNodeParam("Payroll Verification", 7); //"query=g.V().has('name', 'Payroll Verification').emit().repeat(out()).times(7)";
    callback = callback = ajaxModuleLinksReturned; //ajaxEloiseLinksReturned;
    sendAjax(url=url, params=params, callback=callback, method='GET', payload=null);

    params =  assembleLinkedNodeParam("Core", 7); //"query=g.V().has('name', 'Payroll Verification').emit().repeat(out()).times(7)";
    callback = callback = ajaxModuleLinksReturned; //ajaxEloiseLinksReturned;
    sendAjax(url=url, params=params, callback=callback, method='GET', payload=null);





    if (useMyers) {
        fetch('./data/myers_graph.json')
            .then((response) => response.json())
            .then((json) => setJsonNodes(json))
            .then((g) => fullGraphLoaded(g));
    }
    else {
        // fetch('./data/vertices.json')
        //     .then((response) => response.json())
        //     .then((json) => setNodes(json));
    }

    // fetch('./data/payCalcLinkedNodes.json')
    //     .then((response) => response.json())
    //     .then((json) => setPayCalcLinkedNodes(json));

      // fetch('./data/eloiseLinkedNodes.json')
      //   .then((response) => response.json())
      //   .then((json) => setEloiseLinkedNodes(json));



</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>



