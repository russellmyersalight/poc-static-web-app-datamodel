<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Ticket Prediction Playground</title>

  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/ticket_playground_style.css">

  <style>
    body {
      font-family: Arial, sans-serif;
      margin-top: 2em;
      background-color: #f8f9fa;
    }

    .thinking-icon {
      font-size: 2rem;
      animation: pulse 1s infinite ease-in-out;
      margin-top: 10px;
      text-align: center;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      50% {
        transform: scale(1.2);
        opacity: 0.8;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    #loader {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    img.pulsate {
      width: 100px;
      animation: pulse 2s infinite;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="text-center mb-5">
      <h1 class="display-5">AI Ticket Classification Playground</h1>
      <small><small class="text-muted" id="app-version">Version ...</small></small>
    </div>

    <div class="card shadow-sm p-4 mb-4">
      <form id="ticketForm">
        <div class="mb-3">
          <label for="shortDesc" class="form-label">Short Description</label>
          <input type="text" class="form-control" id="shortDesc" placeholder="Enter short description" required>
        </div>

        <div class="mb-3">
          <label for="longDesc" class="form-label">Long Description</label>
          <textarea class="form-control" id="longDesc" rows="5" placeholder="Enter long description" required></textarea>
        </div>

        <div class="text-center">
          <img id="myImage" class="pulsate d-none" src="img/Designer.png" alt="Pulsating Image">
          <div id="loader" class="thinking-icon d-none">ðŸ¤”</div>
        </div>

        <div class="text-center mt-3">
          <button type="button" class="btn btn-primary btn-lg" onclick="submitTicket()">Submit</button>
        </div>
      </form>
    </div>

<!--    <div class="card shadow-sm p-4 mt-4 d-none" id="result">-->
<!--      <h2 class="mb-4">Predictions</h2>-->
<!--      <p><strong>Service Tower:</strong> <span id="tower"></span></p>-->
<!--      <p><strong>Intent:</strong> <span class="text-primary" id="intent"></span></p>-->
<!--      <p><strong>Intent Description:</strong> <span class="text-primary" id="intent-description"></span></p>-->
<!--      <p><strong>Proposed Solution:</strong> <span id="solution"></span></p>-->
<!--      <p><strong>Summary:</strong> <span id="summary"></span></p>-->
<!--    </div>-->
<!--  </div>-->

  <div class="card shadow-sm p-4 mt-4 d-none" id="result">
  <h2 class="mb-4">Predictions</h2>
  <div class="table-responsive">
    <table class="table table-bordered table-striped">
      <tbody>
        <tr>
          <th scope="row">Service Tower</th>
          <td  class="text-primary" id="tower"></td>
        </tr>
        <tr>
          <th scope="row">Intent</th>
          <td class="text-primary" id="intent"></td>
        </tr>
        <tr>
          <th scope="row">Intent Description</th>
          <td class="text-primary" id="intent-description"></td>
        </tr>

        <tr>
          <th scope="row">Summary</th>
          <td id="summary"></td>
        </tr>
        <tr>
          <th scope="row">Proposed Solution</th>
          <td id="solution"></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="text-center mt-3 d-none" id="diagnostics-btn-container">
  <button type="button" class="btn btn-secondary" onclick="toggleDiagnostics()">Show Diagnostics</button>
</div>

<div class="card shadow-sm p-4 mt-4 d-none" id="diagnostics">
  <h4 class="mb-3">Diagnostics</h4>
  <table class="table table-sm table-bordered">
    <tbody>
      <tr><th>API Endpoint</th><td id="diag-api-endpoint" class="text-break"></td></tr>
      <tr><th>Initialization</th><td id="time-init"></td></tr>
      <tr><th>Service Tower Prediction</th><td id="time-serviceTowerPredict"></td></tr>
      <tr><th>Intent Prediction</th><td id="time-intentPredict"></td></tr>
      <tr><th>Summary Generation</th><td id="time-createTicketSummary"></td></tr>
      <tr><th>Proposed Solution Generation</th><td id="time-createProposedSolution"></td></tr>
      <tr><th>Overall</th><td id="time-overall"></td></tr>
    </tbody>
  </table>
</div>
</div>

  <!-- Bootstrap JS (Optional for advanced interactions) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Your existing JS -->
  <script>
  let latestTimeTaken = null;
  var API_ENDPOINT = 'https://func-t-weu-assistant-genai-02.azurewebsites.net/api/predict';  //?code=Ep7ecqT0BHZN4LnUL1U7DCAnhWVJ9XZ309IVeehN2BfhAzFuVxdJVw==';
  API_ENDPOINT_EXTRA = "=";
  API_ENDPOINT_EXTRA +=  "=";
  API_ENDPOINT_EXTRA += "wVJdxVuFzAhfB2NheeVI903ZX9JVWhnACD7U1LUnL4NZHB0Tqce7pE";
  API_ENDPOINT_EXTRA += "=edoc?";
  API_ENDPOINT_EXTRA = API_ENDPOINT_EXTRA.split('').reverse().join('');

  async function submitTicket() {
    const loader = document.getElementById('myImage');
    const resultBox = document.getElementById('result');
    const diagnosticsBtn = document.getElementById('diagnostics-btn-container');
    const diagnosticsSection = document.getElementById('diagnostics');

    loader.classList.remove('d-none');
    resultBox.classList.add('d-none');
    diagnosticsBtn.classList.add('d-none');
    diagnosticsSection.classList.add('d-none');

    const shortDesc = document.getElementById('shortDesc').value;
    const longDesc = document.getElementById('longDesc').value;

    try {
      const response = await fetch(API_ENDPOINT + API_ENDPOINT_EXTRA, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ shortDescription: shortDesc, description: longDesc })
      });

      const data = await response.json();

      document.getElementById('tower').textContent = data.result.predictedServiceTower;
      document.getElementById('intent').textContent = data.result.predictedIntent;
      document.getElementById('intent-description').textContent = data.result.predictedIntentDescription;
      document.getElementById('solution').textContent = data.result.proposedSolution;
      document.getElementById('summary').textContent = data.result.summary;

      // Store timeTaken globally for diagnostics
      latestTimeTaken = data.timeTaken;

      loader.classList.add('d-none');
      resultBox.classList.remove('d-none');
      diagnosticsBtn.classList.remove('d-none');

    } catch (error) {
      console.error('Error fetching prediction:', error);
      loader.classList.add('d-none');
      alert("An error occurred. Please try again.");
    }
  }

function toggleDiagnostics() {
    if (!latestTimeTaken) return;

    document.getElementById('diag-api-endpoint').textContent = API_ENDPOINT; //.substring(0, API_ENDPOINT.indexOf("?"));
    document.getElementById('time-init').textContent = `${latestTimeTaken.init} sec`;
    document.getElementById('time-serviceTowerPredict').textContent = `${latestTimeTaken.serviceTowerPredict} sec`;
    document.getElementById('time-intentPredict').textContent = `${latestTimeTaken.intentPredict} sec`;
    document.getElementById('time-createTicketSummary').textContent = `${latestTimeTaken.createTicketSummary} sec`;
    document.getElementById('time-createProposedSolution').textContent = `${latestTimeTaken.createProposedSolution} sec`;
    document.getElementById('time-overall').textContent = `${latestTimeTaken.overall} sec`;

    document.getElementById('diagnostics').classList.toggle('d-none');
  }

  document.getElementById('longDesc').addEventListener('keydown', function(event) {
  if (event.key === 'Enter' && !event.shiftKey) {
    event.preventDefault();  // Prevent newline insertion
    submitTicket();
  }
});

   fetch('config.json')
    .then(response => {
      if (!response.ok) {
        throw new Error('Failed to load config.json');
      }
      return response.json();
    })
    .then(config => {
      const versionEl = document.getElementById('app-version');
      if (versionEl) {
        versionEl.textContent = `Version ${config.version}`;
      }
    })
    .catch(error => {
      console.error('Error loading config:', error);
    });



  </script>
</body>

</html>
